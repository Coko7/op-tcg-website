import{r as d,j as e,C as F,P as v,O as C,u as y,a as M}from"./three-react-DISlaC8-.js";import{p as f,q as g}from"./three-vendor-DjaRHb79.js";function G({isActive:h}){const l=d.useRef(null),s=200,r=d.useMemo(()=>{const a=new Float32Array(s*3);for(let o=0;o<s;o++)a[o*3]=(Math.random()-.5)*8,a[o*3+1]=Math.random()*6-1,a[o*3+2]=(Math.random()-.5)*8;return a},[]);return y(a=>{if(!l.current||!h)return;const o=l.current.geometry.attributes.position.array;for(let c=0;c<s;c++)o[c*3+1]+=.02,o[c*3+1]>5&&(o[c*3+1]=-1);l.current.geometry.attributes.position.needsUpdate=!0,l.current.rotation.y=a.clock.elapsedTime*.1}),h?e.jsxs("points",{ref:l,children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:s,array:r,itemSize:3,args:[r,3]})}),e.jsx("pointsMaterial",{size:.05,color:"#FFD700",transparent:!0,opacity:.6,sizeAttenuation:!0})]}):null}function S({isOpening:h,onClick:l,animationPhase:s}){const r=d.useRef(null),a=d.useRef(null),o=d.useRef(null),[c,j]=d.useState(1);y(t=>{if(r.current&&(!h&&s==="idle"&&(r.current.rotation.y=Math.sin(t.clock.elapsedTime*.5)*.1,r.current.position.y=Math.sin(t.clock.elapsedTime*.8)*.1),s==="deck"&&(r.current.position.y=g.lerp(r.current.position.y,-3,.02),j(u=>Math.max(0,u-.01)))),a.current&&h){const n=-Math.PI/1.8;a.current.rotation.x=g.lerp(a.current.rotation.x,n,.04)}else a.current&&!h&&(a.current.rotation.x=g.lerp(a.current.rotation.x,0,.05));o.current&&(h?o.current.intensity=g.lerp(o.current.intensity,12,.08):o.current.intensity=g.lerp(o.current.intensity,0,.05))});const x=d.useMemo(()=>new f({color:"#6B3410",roughness:.8,metalness:.05,transparent:!0,opacity:c}),[c]),i=d.useMemo(()=>new f({color:"#FFD700",roughness:.2,metalness:1,emissive:"#D4AF37",emissiveIntensity:.3,transparent:!0,opacity:c}),[c]),p=d.useMemo(()=>new f({color:"#FF1744",emissive:"#FF6B35",emissiveIntensity:.8,roughness:.05,metalness:.9,transparent:!0,opacity:c}),[c]),m=d.useMemo(()=>new f({color:"#888888",roughness:.4,metalness:.95,transparent:!0,opacity:c}),[c]);return e.jsxs("group",{ref:r,onClick:l,children:[e.jsx("pointLight",{ref:o,position:[0,.8,0],color:"#FFD700",intensity:0,distance:12,decay:2}),h&&e.jsxs(e.Fragment,{children:[e.jsx("pointLight",{position:[0,1.5,0],color:"#FFA500",intensity:4,distance:10}),e.jsx("pointLight",{position:[.5,1,.5],color:"#FFD700",intensity:2,distance:6}),e.jsx("pointLight",{position:[-.5,1,-.5],color:"#FF6B35",intensity:2,distance:6})]}),e.jsx("mesh",{position:[0,0,0],castShadow:!0,receiveShadow:!0,material:x,children:e.jsx("boxGeometry",{args:[2.2,1.3,1.6]})}),[-.9,-.3,.3,.9].map((t,n)=>e.jsx("mesh",{position:[t,0,.81],material:x,children:e.jsx("boxGeometry",{args:[.5,1.25,.03]})},`plank-${n}`)),[.5,0,-.5].map((t,n)=>e.jsxs(M.Fragment,{children:[e.jsx("mesh",{position:[0,t,.81],material:i,children:e.jsx("boxGeometry",{args:[2.25,.08,.06]})}),e.jsx("mesh",{position:[0,t,-.81],material:i,children:e.jsx("boxGeometry",{args:[2.25,.08,.06]})})]},`band-h-${n}`)),[[-1.05,.76],[1.05,.76],[-1.05,-.76],[1.05,-.76]].map((t,n)=>e.jsx("mesh",{position:[t[0],0,t[1]],material:m,children:e.jsx("boxGeometry",{args:[.08,1.35,.08]})},`corner-band-${n}`)),e.jsx("group",{position:[0,.65,0],children:e.jsxs("mesh",{ref:a,position:[0,.45,0],rotation:[0,0,0],castShadow:!0,receiveShadow:!0,material:x,children:[e.jsx("boxGeometry",{args:[2.2,.9,1.6]}),[-.9,-.3,.3,.9].map((t,n)=>e.jsx("mesh",{position:[t,0,.81],material:x,children:e.jsx("boxGeometry",{args:[.5,.85,.03]})},`lid-plank-${n}`)),[.3,0,-.3].map((t,n)=>e.jsxs(M.Fragment,{children:[e.jsx("mesh",{position:[0,t,.81],material:i,children:e.jsx("boxGeometry",{args:[2.25,.06,.06]})}),e.jsx("mesh",{position:[0,t,-.81],material:i,children:e.jsx("boxGeometry",{args:[2.25,.06,.06]})})]},`lid-band-${n}`)),e.jsx("mesh",{position:[0,.05,.82],material:i,children:e.jsx("boxGeometry",{args:[.4,.55,.12]})}),e.jsx("mesh",{position:[0,.05,.84],material:i,children:e.jsx("torusGeometry",{args:[.28,.04,8,16]})}),e.jsx("mesh",{position:[0,.05,.845],material:i,children:e.jsx("torusGeometry",{args:[.22,.02,8,16]})}),e.jsx("mesh",{position:[0,.05,.9],material:p,children:e.jsx("dodecahedronGeometry",{args:[.2,0]})}),Array.from({length:8}).map((t,n)=>{const u=n/8*Math.PI*2,b=.35;return e.jsx("mesh",{position:[Math.cos(u)*b,Math.sin(u)*b,.86],material:p,children:e.jsx("octahedronGeometry",{args:[.04,0]})},`small-gem-${n}`)}),e.jsx("mesh",{position:[0,-.3,.83],material:i,children:e.jsx("boxGeometry",{args:[.15,.05,.05]})}),e.jsx("mesh",{position:[0,-.3,.83],material:i,children:e.jsx("boxGeometry",{args:[.05,.15,.05]})})]})}),[[-1,-.65,.75],[1,-.65,.75],[-1,-.65,-.75],[1,-.65,-.75]].map((t,n)=>e.jsxs("group",{position:t,children:[e.jsx("mesh",{material:i,children:e.jsx("cylinderGeometry",{args:[.08,.12,.15,8]})}),e.jsx("mesh",{position:[0,.08,0],material:i,children:e.jsx("sphereGeometry",{args:[.1,8,8]})})]},`foot-${n}`)),[-.8,0,.8].map((t,n)=>e.jsxs("group",{position:[t,.65,-.81],children:[e.jsx("mesh",{material:m,rotation:[Math.PI/2,0,0],children:e.jsx("cylinderGeometry",{args:[.05,.05,.15,8]})}),e.jsx("mesh",{position:[0,.1,0],material:m,children:e.jsx("boxGeometry",{args:[.12,.2,.08]})})]},`hinge-${n}`)),[[-.9,.5,.78],[0,.5,.78],[.9,.5,.78],[-.9,0,.78],[.9,0,.78],[-.9,-.5,.78],[0,-.5,.78],[.9,-.5,.78]].map((t,n)=>e.jsx("mesh",{position:t,material:i,children:e.jsx("sphereGeometry",{args:[.04,8,8]})},`rivet-front-${n}`)),[[-.9,.5,-.78],[0,.5,-.78],[.9,.5,-.78],[-.9,0,-.78],[.9,0,-.78],[-.9,-.5,-.78],[0,-.5,-.78],[.9,-.5,-.78]].map((t,n)=>e.jsx("mesh",{position:t,material:i,children:e.jsx("sphereGeometry",{args:[.04,8,8]})},`rivet-back-${n}`)),[[-1.15,.2,0],[1.15,.2,0]].map((t,n)=>e.jsxs("group",{position:t,children:[e.jsx("mesh",{material:i,rotation:[0,0,Math.PI/2],children:e.jsx("torusGeometry",{args:[.15,.04,8,16]})}),e.jsx("mesh",{position:[0,.15,0],material:i,children:e.jsx("boxGeometry",{args:[.08,.15,.08]})})]},`ring-${n}`)),[[-1.05,.6,.76],[1.05,.6,.76],[-1.05,.6,-.76],[1.05,.6,-.76],[-1.05,-.6,.76],[1.05,-.6,.76],[-1.05,-.6,-.76],[1.05,-.6,-.76]].map((t,n)=>e.jsx("mesh",{position:t,material:i,children:e.jsx("boxGeometry",{args:[.12,.12,.12]})},`corner-detail-${n}`))]})}function w({animationPhase:h}){const l=d.useRef(null);return y(s=>{l.current&&(l.current.position.z=Math.sin(s.clock.elapsedTime*.3)*.2)}),e.jsxs("group",{children:[e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-1.01,0],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[40,40,32,32]}),e.jsx("meshStandardMaterial",{color:"#F4E4C1",roughness:.95,metalness:.05})]}),e.jsxs("mesh",{ref:l,rotation:[-Math.PI/2,0,0],position:[0,-.98,15],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[40,20,32,16]}),e.jsx("meshStandardMaterial",{color:"#1E88E5",roughness:.1,metalness:.8,transparent:!0,opacity:.7})]}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.95,5],children:[e.jsx("planeGeometry",{args:[40,3]}),e.jsx("meshStandardMaterial",{color:"#E3F2FD",roughness:.3,metalness:.2,transparent:!0,opacity:.6})]}),[[-8,-1,-3],[8,-1,-2],[-6,-1,2]].map((s,r)=>e.jsxs("group",{position:s,children:[e.jsxs("mesh",{position:[0,2,0],children:[e.jsx("cylinderGeometry",{args:[.2,.25,4,8]}),e.jsx("meshStandardMaterial",{color:"#8B6F47",roughness:.9})]}),Array.from({length:8}).map((a,o)=>{const c=o/8*Math.PI*2;return e.jsxs("mesh",{position:[Math.cos(c)*.3,4,Math.sin(c)*.3],rotation:[Math.PI/6,c,0],children:[e.jsx("boxGeometry",{args:[.1,2,.6]}),e.jsx("meshStandardMaterial",{color:"#2E7D32",roughness:.7})]},`leaf-${o}`)}),[0,1,2].map(a=>{const o=a/3*Math.PI*2;return e.jsxs("mesh",{position:[Math.cos(o)*.3,3.8,Math.sin(o)*.3],children:[e.jsx("sphereGeometry",{args:[.15,8,8]}),e.jsx("meshStandardMaterial",{color:"#6D4C41",roughness:.8})]},`coconut-${a}`)})]},`palm-${r}`)),[[-4,-.7,1],[5,-.8,-1],[-3,-.75,-2],[6,-.85,3]].map((s,r)=>e.jsxs("mesh",{position:s,castShadow:!0,children:[e.jsx("dodecahedronGeometry",{args:[.5+Math.random()*.3,0]}),e.jsx("meshStandardMaterial",{color:"#78909C",roughness:.9,metalness:.1})]},`rock-${r}`)),Array.from({length:15}).map((s,r)=>{const a=(Math.random()-.5)*20,o=(Math.random()-.5)*10;return e.jsxs("mesh",{position:[a,-.95,o],rotation:[0,Math.random()*Math.PI*2,0],children:[e.jsx("coneGeometry",{args:[.1,.15,6]}),e.jsx("meshStandardMaterial",{color:r%3===0?"#FFF3E0":r%3===1?"#FFE0B2":"#FFCCBC",roughness:.6})]},`shell-${r}`)}),[[-2,-.95,.5],[3,-.95,-.8],[-1,-.95,2]].map((s,r)=>e.jsxs("mesh",{position:s,rotation:[-Math.PI/2,0,r*Math.PI/3],children:[e.jsx("cylinderGeometry",{args:[.25,.25,.05,5]}),e.jsx("meshStandardMaterial",{color:"#FF6F61",roughness:.8})]},`starfish-${r}`)),[[-5,-.9,0],[4,-.9,1]].map((s,r)=>e.jsxs("mesh",{position:s,rotation:[0,r*.5,0],children:[e.jsx("boxGeometry",{args:[2,.1,.3]}),e.jsx("meshStandardMaterial",{color:"#8D6E63",roughness:.9})]},`plank-${r}`)),e.jsxs("mesh",{position:[-10,10,-10],children:[e.jsx("sphereGeometry",{args:[1.5,16,16]}),e.jsx("meshBasicMaterial",{color:"#FFF9C4"})]})]})}function k({cards:h,onCardReveal:l}){const[s,r]=d.useState(0),a=d.useRef(null),[o,c]=d.useState(!1);y(i=>{a.current&&(s===0&&(a.current.position.y=g.lerp(a.current.position.y,2,.05)),a.current.rotation.y=Math.sin(i.clock.elapsedTime*.5)*.05)});const j=()=>{o||s>=h.length||(c(!0),l(s),setTimeout(()=>{r(i=>i+1),c(!1)},600))},x=h.length-s;return e.jsxs("group",{ref:a,position:[0,-2,0],onClick:j,children:[x>0&&e.jsxs(e.Fragment,{children:[Array.from({length:Math.min(x,5)}).map((i,p)=>{const m=s+p,t=h[m];if(!t)return null;const n=p*.05,u={common:"#9CA3AF",uncommon:"#10B981",rare:"#3B82F6",super_rare:"#A855F7",secret_rare:"#FBBF24"}[t.rarity]||"#9CA3AF";return e.jsxs("group",{position:[0,n,-n*.5],children:[e.jsxs("mesh",{castShadow:!0,children:[e.jsx("boxGeometry",{args:[1.2,1.7,.02]}),e.jsx("meshStandardMaterial",{color:"#1F2937",roughness:.3,metalness:.6})]}),e.jsxs("mesh",{position:[0,0,.02],children:[e.jsx("boxGeometry",{args:[1.15,1.65,.01]}),e.jsx("meshStandardMaterial",{color:u,emissive:u,emissiveIntensity:p===0?.5:.2,roughness:.2,metalness:.8})]}),e.jsxs("mesh",{position:[0,0,.03],children:[e.jsx("boxGeometry",{args:[1.1,1.6,.01]}),e.jsx("meshStandardMaterial",{color:"#374151",roughness:.4,metalness:.3})]}),p===0&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,0,.04],children:[e.jsx("torusGeometry",{args:[.3,.05,8,16]}),e.jsx("meshStandardMaterial",{color:u,emissive:u,emissiveIntensity:.6})]}),e.jsxs("mesh",{position:[0,0,.04],children:[e.jsx("sphereGeometry",{args:[.15,8,8]}),e.jsx("meshStandardMaterial",{color:u,emissive:u,emissiveIntensity:.8})]})]})]},`card-${m}`)}),e.jsx("pointLight",{position:[0,1,.5],color:"#FFD700",intensity:2,distance:3})]}),x===0&&e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[.3,16,16]}),e.jsx("meshStandardMaterial",{color:"#10B981",emissive:"#10B981",emissiveIntensity:1,transparent:!0,opacity:.8})]})]})}function I({card:h,position:l}){const s=d.useRef(null),[r,a]=d.useState(0);y(()=>{if(!s.current)return;a(j=>Math.min(j+.02,1)),s.current.rotation.y=r*Math.PI,s.current.position.y=l[1]+Math.sin(r*Math.PI)*1.5,s.current.position.x=g.lerp(-2,l[0],r),s.current.position.z=l[2];const c=1+Math.sin(r*Math.PI)*.2;s.current.scale.set(c,c,1)});const o={common:"#9CA3AF",uncommon:"#10B981",rare:"#3B82F6",super_rare:"#A855F7",secret_rare:"#FBBF24"}[h.rarity]||"#9CA3AF";return e.jsxs("group",{ref:s,position:l,children:[e.jsxs("mesh",{castShadow:!0,children:[e.jsx("boxGeometry",{args:[1.2,1.7,.02]}),e.jsx("meshStandardMaterial",{color:o,emissive:o,emissiveIntensity:.8,roughness:.2,metalness:.9})]}),e.jsx("pointLight",{position:[0,0,.5],color:o,intensity:3,distance:2})]})}function R({isOpening:h,cards:l,animationPhase:s,onClick:r,onCardReveal:a}){const[o,c]=d.useState([]),j=x=>{l&&l[x]&&(c(i=>[...i,l[x]]),a?.(x))};return e.jsxs(e.Fragment,{children:[e.jsx(v,{makeDefault:!0,position:s==="deck"?[0,5,6]:[0,4,7],fov:55}),e.jsx(C,{enabled:s==="idle",enablePan:!1,minDistance:5,maxDistance:15,maxPolarAngle:Math.PI/2.2}),e.jsx("ambientLight",{intensity:.7,color:"#FFF9E6"}),e.jsx("directionalLight",{position:[-10,15,-5],intensity:1.5,color:"#FFFACD",castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-left":-20,"shadow-camera-right":20,"shadow-camera-top":20,"shadow-camera-bottom":-20}),e.jsx("pointLight",{position:[8,5,8],intensity:.4,color:"#B3E5FC"}),e.jsx("pointLight",{position:[-8,5,-8],intensity:.3,color:"#FFE082"}),e.jsx("pointLight",{position:[0,2,10],intensity:.5,color:"#4FC3F7"}),e.jsx(w,{animationPhase:s}),e.jsx(G,{isActive:h||s==="deck"}),(s==="idle"||s==="opening"||s==="deck")&&e.jsx(S,{isOpening:h,onClick:r,animationPhase:s}),s==="deck"&&l&&e.jsx(k,{cards:l,onCardReveal:j}),o.map((x,i)=>e.jsx(I,{card:x,position:[4+i%2*.5,2+i*.3,-i*.2]},`revealed-${x.id}-${i}`)),e.jsxs("mesh",{position:[0,20,-30],scale:[60,40,1],children:[e.jsx("planeGeometry",{}),e.jsx("meshBasicMaterial",{color:"#87CEEB"})]}),e.jsx("fog",{attach:"fog",args:["#B3E5FC",15,35]})]})}const B=({isOpening:h,animationPhase:l,cards:s,onAnimationComplete:r,onClick:a})=>{const[o,c]=d.useState(0),[j,x]=d.useState([]),i=m=>{s&&s[m]&&(c(m+1),x(t=>[...t,s[m]]),m===s.length-1&&setTimeout(()=>{r?.()},1500))},p=m=>{const t={common:"from-gray-600 to-gray-800",uncommon:"from-green-600 to-green-800",rare:"from-blue-600 to-blue-800",super_rare:"from-purple-600 to-purple-800",secret_rare:"from-yellow-500 to-yellow-700"};return t[m]||t.common};return e.jsxs("div",{className:"w-full h-[600px] relative",children:[e.jsx(F,{shadows:!0,gl:{antialias:!0,alpha:!0},className:"bg-gradient-to-b from-sky-300 via-sky-400 to-blue-300 rounded-2xl",children:e.jsx(R,{isOpening:h,cards:s,animationPhase:l,onClick:a,onCardReveal:i})}),l==="idle"&&e.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center",children:e.jsx("p",{className:"text-white/80 text-sm backdrop-blur-sm bg-black/30 py-2 px-4 rounded-lg inline-block",children:"🖱️ Cliquez sur le coffre pour l'ouvrir • Utilisez la souris pour pivoter la vue"})}),l==="deck"&&s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-4 left-0 right-0 text-center z-10",children:e.jsxs("div",{className:"backdrop-blur-sm bg-black/40 py-3 px-6 rounded-lg inline-block",children:[e.jsx("p",{className:"text-white font-semibold text-lg mb-1",children:"🎴 Cliquez sur la pile pour découvrir vos cartes !"}),e.jsxs("p",{className:"text-blue-300 text-sm",children:[o," / ",s.length," cartes révélées"]})]})}),e.jsx("div",{className:"absolute right-4 top-20 bottom-4 w-48 overflow-y-auto space-y-3",children:j.map((m,t)=>e.jsxs("div",{className:`bg-gradient-to-br ${p(m.rarity)} rounded-lg p-2 shadow-2xl transform transition-all duration-500 hover:scale-105`,style:{animation:`slideInRight 0.5s ease-out ${t*.1}s both`},children:[e.jsx("div",{className:"bg-gray-900 rounded-md overflow-hidden",children:m.image_url?e.jsx("img",{src:m.image_url,alt:m.name,className:"w-full h-auto object-cover",onError:n=>{n.target.src="https://via.placeholder.com/300x420?text=No+Image"}}):e.jsx("div",{className:"w-full h-40 flex items-center justify-center bg-gray-800",children:e.jsx("span",{className:"text-gray-500 text-xs",children:"No Image"})})}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("p",{className:"text-white text-xs font-semibold truncate",children:m.name}),e.jsxs("p",{className:"text-white/70 text-xs",children:[m.cost," 💎"]})]})]},`revealed-2d-${m.id}-${t}`))})]}),l==="opening"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"backdrop-blur-sm bg-black/40 py-4 px-8 rounded-xl",children:e.jsx("p",{className:"text-white font-bold text-2xl animate-pulse",children:"✨ Ouverture du coffre... ✨"})})}),e.jsx("style",{children:`
        @keyframes slideInRight {
          from {
            opacity: 0;
            transform: translateX(100px) scale(0.8);
          }
          to {
            opacity: 1;
            transform: translateX(0) scale(1);
          }
        }
      `})]})};export{B as default};
